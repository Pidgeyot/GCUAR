<!DOCTYPE html>
<!--
GCU AR Tour
Made by Paige Mabbitt
September 2nd, 2022
-->
<html lang="en">
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="main.css">
    <script type='text/javascript' src='script.js'></script>
    <!-- include three.js library -->
    <script src='three.js'></script>
    <!-- include jsartookit -->
    <script src="artoolkit.min.js"></script>
    <script src="artoolkit.api.js"></script>
    <!-- include threex.artoolkit -->
    <script src="threex-artoolkitsource.js"></script>
    <script src="threex-artoolkitcontext.js"></script>
    <script src="threex-arbasecontrols.js"></script>
    <script src="threex-armarkercontrols.js"></script>

    <title>GCU AR Tour</title>
</head>
<body>
    <div id="debug">AR</div>

    <div class="AR">
        <!--Videos, need one for each vid?-->
        <iframe id="video1" src="https://youtu.be/Nez7U2L7v2k?autoplay=1" crossOrigin="anonymous" webkit-playsinline style="display:none">
        </iframe>

        <!-- This will contain the THREE.js and AR.js camera and renderer for AR marker usage -->
        <script>

            var scene, camera, renderer, clock, deltaTime, totalTime;

            var arToolkitSource, arToolkitContext;

            var markerRoot1;

            var mesh1;

            initialize();
            animate();

            function initialize() {
                scene = new THREE.Scene();

                let ambientLight = new THREE.AmbientLight(0xcccccc, 0.5);
                scene.add(ambientLight);

                camera = new THREE.Camera();
                scene.add(camera);

                renderer = new THREE.WebGLRenderer({
                    antialias: true,
                    alpha: true
                });
                renderer.setClearColor(new THREE.Color('lightgrey'), 0)
                renderer.setSize(640, 480);
                renderer.domElement.style.position = 'absolute'
                renderer.domElement.style.top = '0px'
                renderer.domElement.style.left = '0px'
                document.body.appendChild(renderer.domElement);

                clock = new THREE.Clock();
                deltaTime = 0;
                totalTime = 0;

                ////////////////////////////////////////////////////////////
                // setup arToolkitSource
                ////////////////////////////////////////////////////////////

                arToolkitSource = new THREEx.ArToolkitSource({
                    sourceType: 'webcam',
                });

                function onResize() {
                    arToolkitSource.onResize()
                    arToolkitSource.copySizeTo(renderer.domElement)
                    if (arToolkitContext.arController !== null) {
                        arToolkitSource.copySizeTo(arToolkitContext.arController.canvas)
                    }
                }

                arToolkitSource.init(function onReady() {
                    onResize()
                });

                // handle resize event
                window.addEventListener('resize', function () {
                    onResize()
                });

                ////////////////////////////////////////////////////////////
                // setup arToolkitContext
                ////////////////////////////////////////////////////////////

                // create atToolkitContext
                arToolkitContext = new THREEx.ArToolkitContext({
                    cameraParametersUrl: 'camera_para.dat',
                    detectionMode: 'mono'
                });

                // copy projection matrix to camera when initialization complete
                arToolkitContext.init(function onCompleted() {
                    camera.projectionMatrix.copy(arToolkitContext.getProjectionMatrix());
                });

                ////////////////////////////////////////////////////////////
                // setup markerRoots
                ////////////////////////////////////////////////////////////

                // build markerControls  !! marker control needed for each marker inputed?? !!
                markerRoot1 = new THREE.Group();
                scene.add(markerRoot1);
                let markerControls1 = new THREEx.ArMarkerControls(arToolkitContext, markerRoot1, {
                    type: 'pattern', patternUrl: "hiro.patt",
                })

                let geometry1 = new THREE.PlaneBufferGeometry(2, 2, 4, 4);

                let video = document.getElementById('video1');
                let texture = new THREE.VideoTexture(video);
                texture.minFilter = THREE.LinearFilter;
                texture.magFilter = THREE.LinearFilter;
                texture.format = THREE.RGBFormat;
                let material1 = new THREE.MeshBasicMaterial({ map: texture });

                mesh1 = new THREE.Mesh(geometry1, material1);
                mesh1.rotation.x = -Math.PI / 2;

                markerRoot1.add(mesh1);
            }


            function update() {
                // update artoolkit on every frame
                if (arToolkitSource.ready !== false)
                    arToolkitContext.update(arToolkitSource.domElement);
            }


            function render() {
                renderer.render(scene, camera);
            }


            function animate() {
                requestAnimationFrame(animate);
                deltaTime = clock.getDelta();
                totalTime += deltaTime;
                update();
                render();
            }

        </script>

    </div>

    <!-- The overlay -->
    <div id="nav" class="overlay">

        <!-- Overlay content -->
        <nav class="overlay-content">
            <a href="tutorial.html">How It Works</a>
            <a href="checklist.html">Checklist</a>
            <a href="https://www.gcu.edu/">GCU School Site</a>
        </nav>

        <!-- Button to close the overlay navigation -->
        <button type="button" href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</button>

    </div>

    <footer>
        <!-- Button to open the overlay navigation -->
        <button type="button" onclick="openNav()" id="ar-open">&#9776;</button>
    </footer>

</body>
</html>